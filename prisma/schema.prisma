generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  // [1. 식별자 및 인증]
  id    String  @id @default(uuid())
  sub   String  @unique // Cognito User ID (필수)
  email String? @unique

  // [2. 프로필 정보]
  name         String? // 이름
  address      String? // 주소
  phoneNumber  String? // 연락처
  profilePhoto String? // 프로필 사진 URL

  // [3. 설정]
  alarmsEnabled Boolean @default(true)
  alarmConfig   Json?
  pushToken     String?
  deviceInfo    Json?
  cameraEnabled Boolean @default(false) // 카메라 사용 설정

  // [4. 시스템 관리]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  // [5. 관계]
  pets Pet[]

  // [NEW] 알림 관계 설정
  notifications Notification[]
}

// [NEW] 알림 테이블 (홈 화면 우측 상단 종 모양)
model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String // 예: "체크인 기록이 쌓였어요"
  body      String // 예: "이번 달 케어 참여 기록이 3일째 이어지고 있어요."
  type      String // SYSTEM, CARE, PROMOTION 등 (확장성 고려)
  isRead    Boolean  @default(false) // 읽음 여부 (뱃지 카운트용)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// [NEW] 케어/체크인 기록 테이블 (홈 화면 캘린더 도장용)
model CareLog {
  id            String   @id @default(uuid())
  petId         String
  date          String // "2026-01-15" (YYYY-MM-DD 포맷, 조회 편의성 위함)
  type          String // "survey"(진단), "check-in"(간편) 등
  createdAt     DateTime @default(now())
  questions     Json? // 진단 질문 및 답변 저장용 (선택 사항)
  answers       Json? // 진단 질문 및 답변 저장용 (선택 사항)
  diagQuestions Json? // 추가 진단 질문 및 답변 저장용 (선택 사항)
  diagAnswers   Json? // 추가 진단 질문 및 답변 저장용 (선택 사항)
  reports       Json? // 진단 결과 리포트 저장용 (선택 사항)

  // 알림 전송 시간 기록
  diagNotificationSentAt   DateTime? // 진단 알림 전송 시간
  reportNotificationSentAt DateTime? // 리포트 알림 전송 시간

  pet Pet @relation(fields: [petId], references: [id], onDelete: Cascade)

  // 한 고양이가 하루에 중복 체크인 방지 (선택 사항)
  @@unique([petId, date])
}

// --- 아래는 기존 Enum 및 Pet 모델 (변동 없음, 관계만 추가됨) ---

enum AdoptionSource {
  shelter
  agency
  private
  rescue
  other
}

enum Weekday {
  mon
  tue
  wed
  thu
  fri
  sat
  sun
}

enum Gender {
  male
  female
}

enum FoodType {
  dry
  wet
  mixed
  prescription
}

enum WaterSource {
  fountain
  bowl
  mixed
}

enum ActivityLevel {
  low
  medium
  high
}

enum LivingEnvironment {
  indoor
  outdoor
  both
}

enum WaterIntakeTendency {
  low
  normal
  high
  unknown
}

enum NotificationPreference {
  all
  important
  none
}

enum MedicationSelectionSource {
  recommended
  search
}

model Pet {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  name               String
  adoptionPath       String
  adoptionSource     AdoptionSource?
  adoptionAgencyCode String?
  agencyCode         String?

  dataSharing      Json?
  careShareStartAt DateTime?
  careShareEndAt   DateTime?

  birthDate       String?
  familyDate      String?
  estimatedAge    Int?
  unknownBirthday Boolean
  gender          Gender
  neutered        Boolean
  breed           String
  weight          Float
  bcs             Float?

  foodType               FoodType
  waterSource            WaterSource
  surveyFrequencyPerWeek Int?
  surveyDays             Weekday[]
  activityLevel          ActivityLevel?
  livingEnvironment      LivingEnvironment?
  multiCat               Boolean?
  catCount               Int?
  mealsPerDay            Int?
  waterIntakeTendency    WaterIntakeTendency?

  medicalHistory         Json?
  medications            String?
  medicationText         String?
  medicationsSelected    Json?
  medicationOtherText    String?
  notes                  String?
  vetInfo                String?
  notificationPreference NotificationPreference?
  profilePhoto           String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  // [NEW] 케어 로그 관계 설정
  careLogs CareLog[]
}

// 기관/의사 테이블
model MedicalProvider {
  id        String  @id @default(uuid())
  userId    String?
  // code      String  @unique // 기관/의사 고유 코드
  type      String // "hospital", "clinic", "doctor", "organization", "individual" 등
  name      String // 기관명 또는 의사명
  address   String? // 주소
  phone     String? // 연락처
  specialty String? // 전문 분야
  notes     String? // 메모

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
